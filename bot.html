<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice-Enabled Botpress Chat</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            text-align: center;
            max-width: 500px;
            width: 100%;
            margin-bottom: 30px;
        }

        h1 {
            color: white;
            margin-bottom: 20px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .voice-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .voice-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            color: white;
            padding: 15px 25px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .voice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .voice-btn:active {
            transform: translateY(0);
        }

        .voice-btn.recording {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            animation: pulse 1.5s ease-in-out infinite alternate;
        }

        @keyframes pulse {
            from {
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            }
            to {
                box-shadow: 0 4px 25px rgba(231, 76, 60, 0.6);
            }
        }

        .tts-btn {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .tts-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .tts-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }

        .status {
            color: white;
            margin: 10px 0;
            font-size: 16px;
            min-height: 24px;
            padding: 5px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chatbot-container {
            width: 100%;
            max-width: 1000px;
            height: 600px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            background: white;
        }

        .chatbot-iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 20px;
        }

        .feature-list {
            color: white;
            text-align: left;
            margin-top: 15px;
            font-size: 14px;
            opacity: 0.9;
        }

        .feature-list li {
            margin: 5px 0;
            list-style: none;
            padding-left: 20px;
            position: relative;
        }

        .feature-list li:before {
            content: "üé§";
            position: absolute;
            left: 0;
        }

        .mic-icon {
            display: inline-block;
            margin-left: 8px;
            font-size: 18px;
        }

        .error-message {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin-bottom: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .chatbot-container {
                height: 500px;
            }
            
            .voice-controls {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé§ Voice Chat Assistant</h1>
        
        <div class="voice-controls">
            <button id="voiceBtn" class="voice-btn">
                Start Recording <span class="mic-icon">üé§</span>
            </button>
            <button id="ttsToggle" class="tts-btn">
                Auto-Read: ON üîä
            </button>
        </div>
        
        <div id="status" class="status">Click "Start Recording" to begin voice input</div>
        
        <ul class="feature-list">
            <li>Click to start voice recording</li>
            <li>Speak your message clearly</li>
            <li>Bot responses are read aloud automatically</li>
            <li>Toggle auto-read on/off as needed</li>
        </ul>
    </div>

    <div class="chatbot-container">
        <iframe 
            id="botpressIframe"
            class="chatbot-iframe"
            src="https://cdn.botpress.cloud/webchat/v3.2/shareable.html?configUrl=https://files.bpcontent.cloud/2025/08/12/15/20250812155352-8W8DCNAV.json"
            title="Botpress Chatbot">
        </iframe>
    </div>

    <script>
        class VoiceChatBot {
            constructor() {
                this.recognition = null;
                this.synthesis = window.speechSynthesis;
                this.isRecording = false;
                this.autoTTS = true;
                this.botpressIframe = document.getElementById('botpressIframe');
                this.voiceBtn = document.getElementById('voiceBtn');
                this.ttsToggle = document.getElementById('ttsToggle');
                this.status = document.getElementById('status');
                
                this.init();
            }

            init() {
                this.initSpeechRecognition();
                this.setupEventListeners();
                this.setupBotpressListener();
            }

            initSpeechRecognition() {
                if ('webkitSpeechRecognition' in window) {
                    this.recognition = new webkitSpeechRecognition();
                } else if ('SpeechRecognition' in window) {
                    this.recognition = new SpeechRecognition();
                } else {
                    this.showError('Speech recognition not supported in this browser');
                    return;
                }

                this.recognition.continuous = false;
                this.recognition.interimResults = false;
                this.recognition.lang = 'en-US';

                this.recognition.onstart = () => {
                    this.isRecording = true;
                    this.updateUI();
                    this.updateStatus('Listening... Speak now!');
                };

                this.recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    this.updateStatus(`Heard: "${transcript}"`);
                    this.sendToBotpress(transcript);
                };

                this.recognition.onerror = (event) => {
                    this.showError(`Speech recognition error: ${event.error}`);
                    this.stopRecording();
                };

                this.recognition.onend = () => {
                    this.stopRecording();
                };
            }

            setupEventListeners() {
                this.voiceBtn.addEventListener('click', () => {
                    if (this.isRecording) {
                        this.stopRecording();
                    } else {
                        this.startRecording();
                    }
                });

                this.ttsToggle.addEventListener('click', () => {
                    this.autoTTS = !this.autoTTS;
                    this.ttsToggle.textContent = this.autoTTS ? 'Auto-Read: ON üîä' : 'Auto-Read: OFF üîá';
                    this.updateStatus(this.autoTTS ? 'Auto-read enabled' : 'Auto-read disabled');
                });
            }

            setupBotpressListener() {
                // Listen for messages from the Botpress iframe
                window.addEventListener('message', (event) => {
                    // Check if message is from Botpress
                    if (event.origin === 'https://cdn.botpress.cloud') {
                        try {
                            const data = event.data;
                            // Look for bot messages
                            if (data && data.type === 'message' && data.payload && data.payload.text) {
                                const botMessage = data.payload.text;
                                if (this.autoTTS && botMessage) {
                                    this.speakText(botMessage);
                                }
                            }
                        } catch (error) {
                            console.log('Message parsing error:', error);
                        }
                    }
                });
            }

            startRecording() {
                if (!this.recognition) {
                    this.showError('Speech recognition not available');
                    return;
                }

                try {
                    this.recognition.start();
                } catch (error) {
                    this.showError('Could not start speech recognition');
                }
            }

            stopRecording() {
                if (this.recognition && this.isRecording) {
                    this.recognition.stop();
                }
                this.isRecording = false;
                this.updateUI();
                this.updateStatus('Click "Start Recording" to speak again');
            }

            sendToBotpress(message) {
                try {
                    // Send message to Botpress iframe
                    this.botpressIframe.contentWindow.postMessage({
                        type: 'send_message',
                        payload: { text: message }
                    }, 'https://cdn.botpress.cloud');
                    
                    this.updateStatus(`Sent: "${message}"`);
                } catch (error) {
                    this.showError('Failed to send message to chatbot');
                }
            }

            speakText(text) {
                if (!text) return;
                
                // Stop any ongoing speech
                this.synthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.9;
                utterance.pitch = 1;
                utterance.volume = 0.8;
                
                utterance.onstart = () => {
                    this.updateStatus('üîä Speaking...');
                };
                
                utterance.onend = () => {
                    this.updateStatus('Ready for next message');
                };
                
                utterance.onerror = () => {
                    this.updateStatus('Speech synthesis error');
                };
                
                this.synthesis.speak(utterance);
            }

            updateUI() {
                if (this.isRecording) {
                    this.voiceBtn.textContent = 'Stop Recording ‚èπÔ∏è';
                    this.voiceBtn.classList.add('recording');
                } else {
                    this.voiceBtn.innerHTML = 'Start Recording <span class="mic-icon">üé§</span>';
                    this.voiceBtn.classList.remove('recording');
                }
            }

            updateStatus(message) {
                this.status.textContent = message;
                // Clear status after 5 seconds if it's not an ongoing state
                if (!message.includes('Listening') && !message.includes('Speaking')) {
                    setTimeout(() => {
                        if (this.status.textContent === message) {
                            this.status.textContent = 'Ready for voice input';
                        }
                    }, 5000);
                }
            }

            showError(message) {
                this.status.innerHTML = `<span class="error-message">‚ùå ${message}</span>`;
            }
        }

        // Initialize the voice chat bot when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new VoiceChatBot();
        });

        // Handle iframe load
        document.getElementById('botpressIframe').addEventListener('load', () => {
            console.log('Botpress iframe loaded successfully');
        });
    </script>
</body>
</html>
