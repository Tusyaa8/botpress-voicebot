<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Botpress + ElevenLabs Voice</title>
  <script src="https://cdn.botpress.cloud/webchat/v3.2/inject.js"></script>
</head>
<body>
  <div id="webchat" style="width: 100%; height: 100vh;"></div>

  <script>
    const ELEVENLABS_API_KEY = "sk_fa514c5e341af3797288d490d3f61eeca7d2dff297190dd8";  // Replace with your ElevenLabs API key
    const VOICE_ID = "EXAVITQu4vr4xnSDxMaL";          // Replace with your selected voice ID

    // Open chat automatically when ready
    window.botpress.on("webchat:ready", () => {
      window.botpress.open();
    });

    // Initialize Botpress Webchat
    window.botpress.init({
      botId: "60be0087-a72c-4cbc-a8d4-40d7bc89b74a",  // replace with your Bot ID
      clientId: "bc050014-0950-4e07-b5f7-ec5ae7c05ff0", 
      selector: "#webchat"
    });

    // Function: Send text to ElevenLabs and play audio
    async function speakWithElevenLabs(text) {
      const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${VOICE_ID}`, {
        method: "POST",
        headers: {
          "Accept": "audio/mpeg",
          "Content-Type": "application/json",
          "xi-api-key": ELEVENLABS_API_KEY
        },
        body: JSON.stringify({
          text: text,
          model_id: "eleven_multilingual_v2"  // best model for multiple languages
        })
      });

      const audioData = await response.arrayBuffer();
      const audioBlob = new Blob([audioData], { type: "audio/mpeg" });
      const audioUrl = URL.createObjectURL(audioBlob);
      const audio = new Audio(audioUrl);
      audio.play();
    }

    // Hook into bot messages
    window.botpress.on("webchat:message", (event) => {
      if (event.message && event.message.type === "text" && event.message.from === "bot") {
        speakWithElevenLabs(event.message.text);
      }
    });
  </script>
</body>
</html>
